# 高德地图集成说明

## 问题描述
资源追踪页面出现错误：`ReferenceError: AMap is not defined`，这是因为页面中没有加载高德地图的JavaScript SDK。

## 解决方案

### 1. 更新HTML文件
已在 `index.html` 中添加了高德地图SDK的引用：

```html
<!-- 高德地图API -->
<script src="https://webapi.amap.com/maps?v=2.0&key=0c125857f468ed6834d9490b6ee95c33"></script>
```

### 2. 优化地图初始化逻辑
在 `resource-tracking.vue` 中优化了地图初始化逻辑：

```typescript
const initMap = () => {
  // 检查高德地图API是否可用
  if (typeof AMap !== 'undefined' && AMap.Map) {
    console.log('高德地图API可用，开始初始化高德地图')
    initAMap()
  } else {
    console.warn('高德地图API不可用，使用模拟地图')
    initMockMap()
  }
}
```

## 配置说明

### 高德地图配置
- **API密钥**：`0c125857f468ed6834d9490b6ee95c33`
- **地图中心**：济宁港区域 `[116.6000, 35.4000]`
- **默认缩放**：10级
- **地图样式**：标准样式
- **视图模式**：3D模式

### 环境变量配置
```env
VITE_AMAP_API_KEY=0c125857f468ed6834d9490b6ee95c33
VITE_MAP_CENTER=116.6000,35.4000
VITE_MAP_ZOOM=10
VITE_MAP_STYLE=amap://styles/normal
VITE_VIEW_MODE=3D
```

## 功能特性

### 高德地图功能
- **3D视图**：支持倾斜、旋转、缩放等3D操作
- **地图控件**：比例尺、工具栏、地图类型切换
- **资源标记点**：在地图上显示监控点、移动设备、人员、设备等
- **交互操作**：支持鼠标拖拽、滚轮缩放、双击缩放等

### 模拟地图功能
- **网格系统**：8条网格线形成地图坐标系统
- **资源点标记**：8个不同类型的资源点
- **交互功能**：点击资源点显示详细信息
- **图例显示**：底部图例清晰显示资源类型

## 降级策略

### 智能降级机制
1. **优先使用高德地图**：如果API可用，优先加载真实地图
2. **自动降级到模拟地图**：如果高德地图API不可用，自动切换到模拟地图
3. **错误处理**：完善的错误捕获和用户友好的错误提示

### 降级触发条件
- 高德地图SDK未加载
- 网络连接问题
- API密钥无效
- 地图初始化失败

## 使用说明

### 页面访问
访问资源追踪页面时，系统会自动：
1. 检查高德地图API是否可用
2. 如果可用，加载真实地图
3. 如果不可用，显示模拟地图
4. 提供地图刷新和图层控制功能

### 地图操作
- **刷新地图**：点击"刷新地图"按钮重新加载地图
- **图层控制**：点击"图层控制"按钮管理地图图层
- **资源点查看**：点击地图上的资源点查看详细信息
- **地图缩放**：使用鼠标滚轮或工具栏进行缩放

## 注意事项

### 网络要求
- 需要稳定的网络连接访问高德地图服务
- 建议在公网环境下使用

### 浏览器兼容性
- 支持现代浏览器（Chrome、Firefox、Safari、Edge）
- 需要支持ES6+语法
- 建议使用最新版本的浏览器

### 性能优化
- 地图加载完成后会缓存地图实例
- 资源标记点支持批量添加和移除
- 组件卸载时会自动清理地图资源

## 故障排除

### 常见问题
1. **地图不显示**：检查网络连接和高德地图API密钥
2. **资源点不显示**：检查地图初始化是否成功
3. **地图操作无响应**：刷新页面重新初始化地图

### 调试方法
1. 打开浏览器开发者工具查看控制台日志
2. 检查网络请求是否成功
3. 验证高德地图API密钥是否有效

## 总结

通过以上配置和优化，资源追踪页面现在能够：
- 自动检测高德地图API可用性
- 智能选择地图显示模式
- 提供完善的错误处理和降级方案
- 支持真实地图和模拟地图两种模式

确保用户在任何情况下都能看到地图内容，提供良好的用户体验。
