# GitHub 部署说明

## 🚀 部署到 GitHub Pages

### 1. 准备工作

#### 1.1 创建 GitHub 仓库
1. 在 GitHub 上创建新仓库
2. 仓库名称：`zjry`（已配置）
3. 选择 Public 或 Private（Private 需要 GitHub Pro）

#### 1.2 配置环境变量
1. 复制 `env.example` 为 `.env`
2. 修改 `.env` 文件中的配置：
   ```bash
   # 修改为你的仓库名
   VITE_BASE_URL=/zjry/
   
   # 如果有高德地图，填入 API Key
   VITE_AMAP_API_KEY=your_actual_api_key
   ```

#### 1.3 修改 Vite 配置
在 `vite.config.ts` 中的 `base` 路径已配置为：
```typescript
base: process.env.NODE_ENV === 'production' ? '/zjry/' : '/',
```

### 2. 上传代码到 GitHub

#### 2.1 初始化 Git 仓库
```bash
git init
git add .
git commit -m "Initial commit: 智慧船舶动态监控系统"
```

#### 2.2 添加远程仓库
```bash
git remote add origin https://github.com/your-username/zjry.git
git branch -M main
git push -u origin main
```

### 3. 配置 GitHub Pages

#### 3.1 启用 GitHub Pages
1. 进入仓库设置 (Settings)
2. 找到 Pages 选项
3. **重要**：Source 选择 "GitHub Actions"

#### 3.2 配置部署分支
- Source: GitHub Actions
- 系统会自动使用 `.github/workflows/pages.yml` 工作流

### 4. 自动部署

#### 4.1 推送代码触发部署
```bash
git add .
git commit -m "Update: 添加新功能"
git push origin main
```

#### 4.2 查看部署状态
1. 进入仓库 Actions 标签页
2. 查看 "Deploy with GitHub Pages" 工作流状态
3. 等待构建和部署完成

### 5. 访问部署的网站

部署成功后，可以通过以下地址访问：
```
https://your-username.github.io/zjry/
```

## 🔧 本地测试

### 构建生产版本
```bash
npm run build:prod
```

### 预览生产版本
```bash
npm run serve
```

### 分析构建包
```bash
npm run analyze
```

## 📝 注意事项

### 1. 环境变量
- `.env` 文件包含敏感信息，不要提交到 Git
- 生产环境使用 GitHub Secrets 管理敏感配置

### 2. 路由配置
- 已配置支持子路径部署 `/zjry/`
- ✅ 已改为 Hash 模式路由（`#`），完全避免刷新 404 问题
- 工作流会自动创建 `404.html` 作为备用方案

### 3. 静态资源
- 图片、字体等静态资源路径要正确
- 使用相对路径或环境变量配置

### 4. API 配置
- 生产环境 API 地址要正确配置
- 考虑 CORS 和跨域问题

## 🐛 常见问题

### 1. 页面 404 错误
- ✅ 已配置 `vite.config.ts` 中的 `base: '/zjry/'`
- ✅ 工作流会自动创建 `404.html` 处理 SPA 路由
- 确保仓库名为 `zjry`

### 2. 静态资源加载失败
- 检查资源路径是否正确
- 确认构建输出目录结构

### 3. 环境变量未生效
- 检查 `.env` 文件格式
- 确认环境变量前缀为 `VITE_`

### 4. 构建失败
- 检查 TypeScript 类型错误
- 确认依赖包版本兼容性

### 5. 部署一直排队
- 确保 GitHub Pages 设置中选择 "GitHub Actions"
- 检查工作流权限配置
- 确保仓库有 `pages: write` 权限

## 🔄 工作流说明

### 新的官方工作流特点
- 使用 `actions/deploy-pages@v4`（官方推荐）
- 自动创建 `404.html` 解决 SPA 路由问题
- 支持并发部署控制
- 更安全的权限管理

### 工作流步骤
1. **构建阶段**：安装依赖 → 构建项目 → 创建 404.html → 上传制品
2. **部署阶段**：部署到 GitHub Pages → 输出部署 URL

## 📚 相关链接

- [Vite 部署指南](https://vitejs.dev/guide/static-deploy.html)
- [GitHub Pages 文档](https://docs.github.com/en/pages)
- [GitHub Actions 文档](https://docs.github.com/en/actions)
- [Vue Router 部署](https://router.vuejs.org/guide/essentials/history-mode.html)
