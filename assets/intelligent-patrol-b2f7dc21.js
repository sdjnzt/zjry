import{d as a,f as e,r as l,c as t,o as s,b as i,V as n,W as u,a0 as d,k as r,$ as o,X as c,u as m,G as v,F as p,a1 as g,a8 as y,a3 as h,B as f,a7 as k,_}from"./vendor-f41c3cc7.js";import{o as C,V as P}from"./icons-15893848.js";import{m as T,P as w,c as x,R as b}from"./antd-fa5730cf.js";import{_ as z}from"./index-3f839e27.js";const I={class:"intelligent-patrol"},U={class:"page-header"},$={class:"header-content"},q={class:"header-actions"},D={class:"main-content"},R={class:"left-panel"},S={class:"patrol-list"},B=["onClick"],j={class:"patrol-info"},Y={class:"patrol-name"},A={class:"patrol-meta"},H={class:"interval"},L={class:"camera-count"},M={class:"patrol-status"},E={class:"patrol-actions"},K={class:"right-panel"},V={class:"control-bar"},F={class:"current-info"},G={class:"status-text"},O={class:"control-buttons"},W={class:"camera-matrix"},X={class:"matrix-header"},J={class:"matrix-title"},N={class:"matrix-grid"},Q={class:"cell-header"},Z={class:"camera-name"},aa={class:"camera-status"},ea={class:"cell-content"},la={key:0,class:"video-display"},ta={key:0,class:"camera-image"},sa=["src","alt"],ia={class:"time-overlay"},na={class:"timestamp"},ua={key:1,class:"camera-video"},da=["src"],ra={class:"time-overlay"},oa={class:"timestamp"},ca={key:2,class:"video-placeholder"},ma={class:"camera-name"},va={class:"camera-location"},pa={key:1,class:"empty-slot"},ga={key:0,class:"patrol-progress"},ya={class:"progress-header"},ha={class:"progress-text"},fa={class:"next-switch"},ka={class:"camera-picker"},_a=z(a({__name:"intelligent-patrol",setup(a){const z=e(null),_a=e(null),Ca=e(0),Pa=e(!1),Ta=e(null),wa=e(null),xa=e(0),ba=e([{camera:null,index:0},{camera:null,index:1},{camera:null,index:2},{camera:null,index:3}]),za=e(!1),Ia=e(""),Ua=e([]),$a=e(-1),qa=l({name:"",interval:30,selectedCameras:[],strategy:"sequential",timeRange:[]}),Da=e([{id:1,name:"码头重点区域轮巡",status:"running",interval:30,cameras:[{id:1,name:"锚地1号监控",location:"码头前沿A区",status:"在线",mediaType:"image",mediaPath:"/image/4.png"},{id:2,name:"码头2号监控",location:"码头前沿B区",status:"在线",mediaType:"image",mediaPath:"/image/2.png"},{id:3,name:"码头3号监控",location:"码头前沿C区",status:"在线",mediaType:"image",mediaPath:"/image/3.png"}]},{id:2,name:"航道监控轮巡",status:"stopped",interval:45,cameras:[{id:4,name:"主航道1号",location:"主航道入口",status:"在线",mediaType:"image",mediaPath:"/image/4.png"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/image/1.png"}]},{id:3,name:"锚地区域轮巡",status:"stopped",interval:60,cameras:[{id:6,name:"锚地监控点",location:"锚地区域中心",status:"在线",mediaType:"image",mediaPath:"/image/1.png"}]},{id:4,name:"港区周界巡检",status:"stopped",interval:50,cameras:[{id:7,name:"码头4号监控",location:"码头前沿D区",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{id:1,name:"码头1号监控",location:"码头前沿A区",status:"在线",mediaType:"video",mediaPath:"/image/1.mp4"}]},{id:5,name:"桥区桥面/引桥监控",status:"stopped",interval:40,cameras:[{id:8,name:"航道3号监控",location:"主航道出口",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/image/1.png"}]}]),Ra=e([{key:1,title:"码头1号监控",location:"码头前沿A区",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{key:2,title:"码头2号监控",location:"码头前沿B区",status:"在线",mediaType:"image",mediaPath:"/image/2.png"},{key:3,title:"码头3号监控",location:"码头前沿C区",status:"在线",mediaType:"image",mediaPath:"/image/3.png"},{key:4,title:"主航道1号",location:"主航道入口",status:"在线",mediaType:"image",mediaPath:"/image/4.png"},{key:5,title:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{key:6,title:"锚地监控点",location:"锚地区域中心",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{key:7,title:"码头4号监控",location:"码头前沿D区",status:"在线",mediaType:"image",mediaPath:"/image/1.png"},{key:8,title:"航道3号监控",location:"主航道出口",status:"在线",mediaType:"image",mediaPath:"/image/1.png"}]),Sa=t(()=>z.value?(Ca.value+1)/z.value.cameras.length*100:0),Ba=t(()=>{const a=Ia.value.trim().toLowerCase();return a?Ra.value.filter(e=>e.title.toLowerCase().includes(a)||e.location.toLowerCase().includes(a)):Ra.value}),ja=[{title:"摄像头名称",dataIndex:"title",key:"title",width:200},{title:"位置",dataIndex:"location",key:"location",width:180},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:100}],Ya=a=>{z.value=a,a.cameras.length>0&&(Ca.value=0,_a.value=a.cameras[0])},Aa=a=>{var e;a.status="running",a.id===(null==(e=z.value)?void 0:e.id)&&(La(),T.success(`预案"${a.name}"已启动`))},Ha=a=>{var e;a.status="stopped",a.id===(null==(e=z.value)?void 0:e.id)&&(Ma(),T.info(`预案"${a.name}"已停止`))},La=()=>{wa.value&&clearInterval(wa.value),xa.value=z.value.interval,wa.value=setInterval(()=>{xa.value--,xa.value<=0&&(Ea(),xa.value=z.value.interval)},1e3)},Ma=()=>{wa.value&&(clearInterval(wa.value),wa.value=null)},Ea=()=>{z.value&&(Ca.value=(Ca.value+1)%z.value.cameras.length,_a.value=z.value.cameras[Ca.value])},Ka=()=>{z.value&&(Ca.value=0===Ca.value?z.value.cameras.length-1:Ca.value-1,_a.value=z.value.cameras[Ca.value])},Va=()=>{z.value&&(Ma(),T.info("轮巡已暂停"))},Fa=a=>{Ua.value=a},Ga=()=>{ba.value.forEach(a=>{a.camera=null}),T.info("矩阵已重置")},Oa=()=>{Ta.value=null,Ja(),Pa.value=!0},Wa=()=>{if(Ta.value)Ta.value.name=qa.name,Ta.value.interval=qa.interval,Ta.value.cameras=qa.selectedCameras.map(a=>{const e=Ra.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath}:null}).filter(Boolean),T.success("预案已更新");else{const a={id:Date.now(),name:qa.name,status:"stopped",interval:qa.interval,cameras:qa.selectedCameras.map(a=>{const e=Ra.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath}:null}).filter(Boolean)};Da.value.push(a),T.success("预案已创建")}Pa.value=!1,Ja()},Xa=()=>{Pa.value=!1,Ja()},Ja=()=>{qa.name="",qa.interval=30,qa.selectedCameras=[],qa.strategy="sequential",qa.timeRange=[]},Na=()=>{const a=new Date;return`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return s(()=>{console.log("智能轮巡组件已挂载"),(()=>{const a=Da.value[0];a&&a.cameras.length>0&&a.cameras.forEach((a,e)=>{e<3&&(ba.value[e].camera={id:a.id,name:a.name,location:a.location,status:a.status,mediaType:a.mediaType,mediaPath:a.mediaPath})})})(),Da.value.length>0&&Ya(Da.value[0])}),i(()=>{wa.value&&clearInterval(wa.value)}),(a,e)=>{const l=c("a-button"),t=c("a-tag"),s=c("a-card"),i=c("a-button-group"),wa=c("a-progress"),La=c("a-input"),Ja=c("a-form-item"),Qa=c("a-col"),Za=c("a-input-number"),ae=c("a-row"),ee=c("a-transfer"),le=c("a-radio"),te=c("a-radio-group"),se=c("a-range-picker"),ie=c("a-form"),ne=c("a-modal"),ue=c("a-input-search"),de=c("a-table");return n(),u("div",I,[d("div",U,[d("div",$,[e[9]||(e[9]=d("div",{class:"title-section"},[d("h1",null,"智能轮巡"),d("p",null,"预设视频轮巡预案，系统自动按设定时间间隔切换大屏显示画面")],-1)),d("div",q,[r(l,{type:"primary",size:"large",onClick:Oa},{default:o(()=>[r(m(w)),e[8]||(e[8]=v(" 新建预案 ",-1))]),_:1})])])]),d("div",D,[d("div",R,[r(s,{title:"轮巡预案管理",class:"patrol-card"},{default:o(()=>[d("div",S,[(n(!0),u(p,null,g(Da.value,a=>{var s;return n(),u("div",{key:a.id,class:y(["patrol-item",{active:(null==(s=z.value)?void 0:s.id)===a.id}]),onClick:e=>Ya(a)},[d("div",j,[d("div",Y,h(a.name),1),d("div",A,[d("span",H,"间隔: "+h(a.interval)+"秒",1),d("span",L,h(a.cameras.length)+"个摄像头",1)])]),d("div",M,[r(t,{color:"running"===a.status?"success":"default"},{default:o(()=>[v(h("running"===a.status?"运行中":"已停止"),1)]),_:2},1032,["color"])]),d("div",E,[r(l,{size:"small",type:"running"===a.status?"default":"primary",onClick:f(e=>(a=>{"running"===a.status?Ha(a):Aa(a)})(a),["stop"])},{default:o(()=>[v(h("running"===a.status?"停止":"启动"),1)]),_:2},1032,["type","onClick"]),r(l,{size:"small",onClick:f(e=>(a=>{Ta.value=a,qa.name=a.name,qa.interval=a.interval,qa.selectedCameras=a.cameras.map(a=>a.id),qa.strategy="sequential",Pa.value=!0})(a),["stop"])},{default:o(()=>[...e[10]||(e[10]=[v(" 编辑 ",-1)])]),_:2},1032,["onClick"]),r(l,{size:"small",danger:"",onClick:f(e=>(a=>{var e;const l=Da.value.findIndex(e=>e.id===a.id);l>-1&&(Da.value.splice(l,1),(null==(e=z.value)?void 0:e.id)===a.id&&(z.value=null,_a.value=null,Ma()),T.success("预案已删除"))})(a),["stop"])},{default:o(()=>[...e[11]||(e[11]=[v(" 删除 ",-1)])]),_:2},1032,["onClick"])])],10,B)}),128))])]),_:1})]),d("div",K,[r(s,{title:"轮巡预览",class:"preview-card"},{default:o(()=>{var a;return[d("div",V,[d("div",F,[d("h3",null,h(z.value?z.value.name:"未选择预案"),1),d("span",G,h("running"===(null==(a=z.value)?void 0:a.status)?"运行中":"已停止"),1)]),d("div",O,[r(i,null,{default:o(()=>[r(l,{disabled:!z.value||"running"!==z.value.status,onClick:Ka},{default:o(()=>[r(m(x)),e[12]||(e[12]=v(" 上一个 ",-1))]),_:1},8,["disabled"]),r(l,{disabled:!z.value||"running"!==z.value.status,onClick:Va},{default:o(()=>[r(m(C)),e[13]||(e[13]=v(" 暂停 ",-1))]),_:1},8,["disabled"]),r(l,{disabled:!z.value||"running"!==z.value.status,onClick:Ea},{default:o(()=>[e[14]||(e[14]=v(" 下一个 ",-1)),r(m(b))]),_:1},8,["disabled"])]),_:1})])]),d("div",W,[d("div",X,[d("span",J,"摄像头矩阵 ("+h(ba.value.length)+"个位置)",1),r(l,{size:"small",onClick:Ga},{default:o(()=>[...e[15]||(e[15]=[v("重置矩阵",-1)])]),_:1})]),d("div",N,[(n(!0),u(p,null,g(ba.value,(a,s)=>{var i,c,p,g;return n(),u("div",{key:`cell-${s}`,class:y(["matrix-cell",{"has-camera":!!a.camera,"current-active":"running"===(null==(i=z.value)?void 0:i.status)&&Ca.value===s}])},[d("div",Q,[d("div",Z,h((null==(c=a.camera)?void 0:c.name)||"未配置"),1),d("div",aa,[r(t,{color:a.camera?"success":"default",size:"small"},{default:o(()=>[v(h(a.camera?"已配置":"未配置"),1)]),_:2},1032,["color"])])]),d("div",ea,[a.camera&&a.camera.id?(n(),u("div",la,["image"===a.camera.mediaType&&a.camera.mediaPath?(n(),u("div",ta,[d("img",{src:a.camera.mediaPath,alt:`${a.camera.name}摄像头`,class:"camera-img"},null,8,sa),d("div",ia,[d("div",na,h(Na()),1)])])):"video"===a.camera.mediaType&&a.camera.mediaPath?(n(),u("div",ua,[d("video",{src:a.camera.mediaPath,autoplay:"",muted:"",loop:"",class:"camera-vid"},null,8,da),d("div",ra,[d("div",oa,h(Na()),1)])])):(n(),u("div",ca,[r(m(P),{class:"camera-icon"}),d("div",ma,h((null==(p=a.camera)?void 0:p.name)||""),1),d("div",va,h((null==(g=a.camera)?void 0:g.location)||""),1)]))])):a.camera&&a.camera.id?k("",!0):(n(),u("div",pa,[r(m(w),{class:"add-icon"}),e[17]||(e[17]=d("div",{class:"add-text"},"添加摄像头",-1)),r(l,{size:"small",type:"primary",onClick:a=>{return e=s,$a.value=e,za.value=!0,void(Ua.value=[]);var e}},{default:o(()=>[...e[16]||(e[16]=[v(" 选择 ",-1)])]),_:2},1032,["onClick"])]))])],2)}),128))])]),z.value&&"running"===z.value.status?(n(),u("div",ga,[d("div",ya,[d("span",ha,"轮巡进度: "+h(Ca.value+1)+"/"+h(z.value.cameras.length),1),d("span",fa,"下次切换: "+h(xa.value)+"秒",1)]),r(wa,{percent:Sa.value,"show-info":!1,"stroke-color":{"0%":"#1890ff","100%":"#52c41a"}},null,8,["percent"])])):k("",!0)]}),_:1})])]),r(ne,{open:Pa.value,"onUpdate:open":e[5]||(e[5]=a=>Pa.value=a),title:Ta.value?"编辑轮巡预案":"新建轮巡预案",width:"700px",onOk:Wa,onCancel:Xa},{default:o(()=>[r(ie,{model:qa,layout:"vertical"},{default:o(()=>[r(ae,{gutter:16},{default:o(()=>[r(Qa,{span:12},{default:o(()=>[r(Ja,{label:"预案名称",required:""},{default:o(()=>[r(La,{value:qa.name,"onUpdate:value":e[0]||(e[0]=a=>qa.name=a),placeholder:"请输入预案名称"},null,8,["value"])]),_:1})]),_:1}),r(Qa,{span:12},{default:o(()=>[r(Ja,{label:"轮巡间隔(秒)",required:""},{default:o(()=>[r(Za,{value:qa.interval,"onUpdate:value":e[1]||(e[1]=a=>qa.interval=a),min:5,max:300,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),r(Ja,{label:"选择摄像头",required:""},{default:o(()=>[r(ee,{"target-keys":qa.selectedCameras,"onUpdate:targetKeys":e[2]||(e[2]=a=>qa.selectedCameras=a),"data-source":Ra.value,titles:["可选摄像头","已选摄像头"],render:a=>a.title,"show-search":!0,"show-select-all":!1},null,8,["target-keys","data-source","render"])]),_:1}),r(Ja,{label:"轮巡策略"},{default:o(()=>[r(te,{value:qa.strategy,"onUpdate:value":e[3]||(e[3]=a=>qa.strategy=a)},{default:o(()=>[r(le,{value:"sequential"},{default:o(()=>[...e[18]||(e[18]=[v("顺序轮巡",-1)])]),_:1}),r(le,{value:"random"},{default:o(()=>[...e[19]||(e[19]=[v("随机轮巡",-1)])]),_:1}),r(le,{value:"priority"},{default:o(()=>[...e[20]||(e[20]=[v("优先级轮巡",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),r(Ja,{label:"生效时间"},{default:o(()=>[r(se,{value:qa.timeRange,"onUpdate:value":e[4]||(e[4]=a=>qa.timeRange=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),r(ne,{open:za.value,"onUpdate:open":e[7]||(e[7]=a=>za.value=a),title:"选择摄像头",width:"900px",footer:null},{default:o(()=>[d("div",ka,[r(ue,{value:Ia.value,"onUpdate:value":e[6]||(e[6]=a=>Ia.value=a),placeholder:"搜索摄像头名称或位置",style:{"margin-bottom":"16px"},"allow-clear":""},null,8,["value"]),r(de,{columns:ja,"data-source":Ba.value,"row-key":"id",size:"middle",pagination:{pageSize:10,showSizeChanger:!0},"row-selection":{selectedRowKeys:Ua.value,onChange:Fa}},{bodyCell:o(({column:a,record:s})=>["status"===a.key?(n(),_(t,{key:0,color:"success"},{default:o(()=>[...e[21]||(e[21]=[v("在线",-1)])]),_:1})):"action"===a.key?(n(),_(l,{key:1,type:"link",onClick:a=>{return e=s,void($a.value>=0&&(ba.value[$a.value].camera={id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath},za.value=!1,T.success(`已选择摄像头: ${e.title}`)));var e}},{default:o(()=>[...e[22]||(e[22]=[v("选择",-1)])]),_:2},1032,["onClick"])):k("",!0)]),_:1},8,["data-source","row-selection"])])]),_:1},8,["open"])])}}}),[["__scopeId","data-v-a1a1a3e0"]]);export{_a as default};
