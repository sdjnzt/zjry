import{d as a,f as e,r as l,c as t,o as s,b as n,V as u,W as i,a0 as r,k as o,$ as c,X as d,u as v,G as m,F as p,a1 as f,a8 as g,a3 as k,B as y,a7 as h,_}from"./vendor-f41c3cc7.js";import{o as C,V as w}from"./icons-15893848.js";import{m as x,P as b,c as z,R as I}from"./antd-fa5730cf.js";import{_ as U}from"./index-a86697a3.js";const q={class:"intelligent-patrol"},R={class:"page-header"},B={class:"header-content"},D={class:"header-actions"},$={class:"main-content"},j={class:"left-panel"},Y={class:"patrol-list"},A=["onClick"],L={class:"patrol-info"},H={class:"patrol-name"},K={class:"patrol-meta"},M={class:"interval"},S={class:"camera-count"},V={class:"patrol-status"},E={class:"patrol-actions"},F={class:"right-panel"},G={class:"control-bar"},O={class:"current-info"},P={class:"status-text"},W={class:"control-buttons"},X={class:"camera-matrix"},J={class:"matrix-header"},N={class:"matrix-title"},Q={class:"matrix-grid"},T={class:"cell-header"},Z={class:"camera-name"},aa={class:"camera-status"},ea={class:"cell-content"},la={key:0,class:"video-display"},ta={class:"video-placeholder"},sa={class:"camera-name"},na={class:"camera-location"},ua={key:1,class:"empty-slot"},ia={key:0,class:"patrol-progress"},ra={class:"progress-header"},oa={class:"progress-text"},ca={class:"next-switch"},da={class:"camera-picker"},va=U(a({__name:"intelligent-patrol",setup(a){const U=e(null),va=e(null),ma=e(0),pa=e(!1),fa=e(null),ga=e(null),ka=e(0),ya=e([{camera:null,index:0},{camera:null,index:1},{camera:null,index:2},{camera:null,index:3}]),ha=e(!1),_a=e(""),Ca=e([]),wa=e(-1),xa=l({name:"",interval:30,selectedCameras:[],strategy:"sequential",timeRange:[]}),ba=e([{id:1,name:"码头重点区域轮巡",status:"running",interval:30,cameras:[{id:1,name:"码头1号监控",location:"码头前沿A区",status:"在线"},{id:2,name:"码头2号监控",location:"码头前沿B区",status:"在线"},{id:3,name:"码头3号监控",location:"码头前沿C区",status:"在线"}]},{id:2,name:"航道监控轮巡",status:"stopped",interval:45,cameras:[{id:4,name:"主航道1号",location:"主航道入口",status:"在线"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线"}]},{id:3,name:"锚地区域轮巡",status:"stopped",interval:60,cameras:[{id:6,name:"锚地监控点",location:"锚地区域中心",status:"在线"}]},{id:4,name:"港区周界巡检",status:"stopped",interval:50,cameras:[{id:7,name:"码头4号监控",location:"码头前沿D区",status:"在线"},{id:1,name:"码头1号监控",location:"码头前沿A区",status:"在线"}]},{id:5,name:"桥区桥面/引桥监控",status:"stopped",interval:40,cameras:[{id:8,name:"航道3号监控",location:"主航道出口",status:"在线"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线"}]}]),za=e([{key:1,title:"码头1号监控",location:"码头前沿A区",status:"在线"},{key:2,title:"码头2号监控",location:"码头前沿B区",status:"在线"},{key:3,title:"码头3号监控",location:"码头前沿C区",status:"在线"},{key:4,title:"主航道1号",location:"主航道入口",status:"在线"},{key:5,title:"主航道2号",location:"主航道中段",status:"在线"},{key:6,title:"锚地监控点",location:"锚地区域中心",status:"在线"},{key:7,title:"码头4号监控",location:"码头前沿D区",status:"在线"},{key:8,title:"航道3号监控",location:"主航道出口",status:"在线"}]),Ia=t(()=>U.value?(ma.value+1)/U.value.cameras.length*100:0),Ua=t(()=>{const a=_a.value.trim().toLowerCase();return a?za.value.filter(e=>e.title.toLowerCase().includes(a)||e.location.toLowerCase().includes(a)):za.value}),qa=[{title:"摄像头名称",dataIndex:"title",key:"title",width:200},{title:"位置",dataIndex:"location",key:"location",width:180},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:100}],Ra=a=>{U.value=a,a.cameras.length>0&&(ma.value=0,va.value=a.cameras[0],Ka())},Ba=a=>{var e;a.status="running",a.id===(null==(e=U.value)?void 0:e.id)&&($a(),x.success(`预案"${a.name}"已启动`))},Da=a=>{var e;a.status="stopped",a.id===(null==(e=U.value)?void 0:e.id)&&(ja(),x.info(`预案"${a.name}"已停止`))},$a=()=>{ga.value&&clearInterval(ga.value),ka.value=U.value.interval,ga.value=setInterval(()=>{ka.value--,ka.value<=0&&(Ya(),ka.value=U.value.interval)},1e3)},ja=()=>{ga.value&&(clearInterval(ga.value),ga.value=null)},Ya=()=>{U.value&&(ma.value=(ma.value+1)%U.value.cameras.length,va.value=U.value.cameras[ma.value])},Aa=()=>{U.value&&(ma.value=0===ma.value?U.value.cameras.length-1:ma.value-1,va.value=U.value.cameras[ma.value])},La=()=>{U.value&&(ja(),x.info("轮巡已暂停"))},Ha=a=>{Ca.value=a},Ka=()=>{ya.value.forEach(a=>{a.camera=null}),x.info("矩阵已重置")},Ma=()=>{fa.value=null,Ea(),pa.value=!0},Sa=()=>{if(fa.value)fa.value.name=xa.name,fa.value.interval=xa.interval,fa.value.cameras=xa.selectedCameras.map(a=>{const e=za.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status}:null}).filter(Boolean),x.success("预案已更新");else{const a={id:Date.now(),name:xa.name,status:"stopped",interval:xa.interval,cameras:xa.selectedCameras.map(a=>{const e=za.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status}:null}).filter(Boolean)};ba.value.push(a),x.success("预案已创建")}pa.value=!1,Ea()},Va=()=>{pa.value=!1,Ea()},Ea=()=>{xa.name="",xa.interval=30,xa.selectedCameras=[],xa.strategy="sequential",xa.timeRange=[]};return s(()=>{console.log("智能轮巡组件已挂载"),ba.value.length>0&&Ra(ba.value[0])}),n(()=>{ga.value&&clearInterval(ga.value)}),(a,e)=>{const l=d("a-button"),t=d("a-tag"),s=d("a-card"),n=d("a-button-group"),ga=d("a-progress"),$a=d("a-input"),Ea=d("a-form-item"),Fa=d("a-col"),Ga=d("a-input-number"),Oa=d("a-row"),Pa=d("a-transfer"),Wa=d("a-radio"),Xa=d("a-radio-group"),Ja=d("a-range-picker"),Na=d("a-form"),Qa=d("a-modal"),Ta=d("a-input-search"),Za=d("a-table");return u(),i("div",q,[r("div",R,[r("div",B,[e[9]||(e[9]=r("div",{class:"title-section"},[r("h1",null,"智能轮巡"),r("p",null,"预设视频轮巡预案，系统自动按设定时间间隔切换大屏显示画面")],-1)),r("div",D,[o(l,{type:"primary",size:"large",onClick:Ma},{default:c(()=>[o(v(b)),e[8]||(e[8]=m(" 新建预案 ",-1))]),_:1})])])]),r("div",$,[r("div",j,[o(s,{title:"轮巡预案管理",class:"patrol-card"},{default:c(()=>[r("div",Y,[(u(!0),i(p,null,f(ba.value,a=>{var s;return u(),i("div",{key:a.id,class:g(["patrol-item",{active:(null==(s=U.value)?void 0:s.id)===a.id}]),onClick:e=>Ra(a)},[r("div",L,[r("div",H,k(a.name),1),r("div",K,[r("span",M,"间隔: "+k(a.interval)+"秒",1),r("span",S,k(a.cameras.length)+"个摄像头",1)])]),r("div",V,[o(t,{color:"running"===a.status?"success":"default"},{default:c(()=>[m(k("running"===a.status?"运行中":"已停止"),1)]),_:2},1032,["color"])]),r("div",E,[o(l,{size:"small",type:"running"===a.status?"default":"primary",onClick:y(e=>(a=>{"running"===a.status?Da(a):Ba(a)})(a),["stop"])},{default:c(()=>[m(k("running"===a.status?"停止":"启动"),1)]),_:2},1032,["type","onClick"]),o(l,{size:"small",onClick:y(e=>(a=>{fa.value=a,xa.name=a.name,xa.interval=a.interval,xa.selectedCameras=a.cameras.map(a=>a.id),xa.strategy="sequential",pa.value=!0})(a),["stop"])},{default:c(()=>[...e[10]||(e[10]=[m(" 编辑 ",-1)])]),_:2},1032,["onClick"]),o(l,{size:"small",danger:"",onClick:y(e=>(a=>{var e;const l=ba.value.findIndex(e=>e.id===a.id);l>-1&&(ba.value.splice(l,1),(null==(e=U.value)?void 0:e.id)===a.id&&(U.value=null,va.value=null,ja()),x.success("预案已删除"))})(a),["stop"])},{default:c(()=>[...e[11]||(e[11]=[m(" 删除 ",-1)])]),_:2},1032,["onClick"])])],10,A)}),128))])]),_:1})]),r("div",F,[o(s,{title:"轮巡预览",class:"preview-card"},{default:c(()=>{var a;return[r("div",G,[r("div",O,[r("h3",null,k(U.value?U.value.name:"未选择预案"),1),r("span",P,k("running"===(null==(a=U.value)?void 0:a.status)?"运行中":"已停止"),1)]),r("div",W,[o(n,null,{default:c(()=>[o(l,{disabled:!U.value||"running"!==U.value.status,onClick:Aa},{default:c(()=>[o(v(z)),e[12]||(e[12]=m(" 上一个 ",-1))]),_:1},8,["disabled"]),o(l,{disabled:!U.value||"running"!==U.value.status,onClick:La},{default:c(()=>[o(v(C)),e[13]||(e[13]=m(" 暂停 ",-1))]),_:1},8,["disabled"]),o(l,{disabled:!U.value||"running"!==U.value.status,onClick:Ya},{default:c(()=>[e[14]||(e[14]=m(" 下一个 ",-1)),o(v(I))]),_:1},8,["disabled"])]),_:1})])]),r("div",X,[r("div",J,[r("span",N,"摄像头矩阵 ("+k(ya.value.length)+"个位置)",1),o(l,{size:"small",onClick:Ka},{default:c(()=>[...e[15]||(e[15]=[m("重置矩阵",-1)])]),_:1})]),r("div",Q,[(u(!0),i(p,null,f(ya.value,(a,s)=>{var n,d,p,f;return u(),i("div",{key:`cell-${s}`,class:g(["matrix-cell",{"has-camera":!!a.camera,"current-active":"running"===(null==(n=U.value)?void 0:n.status)&&ma.value===s}])},[r("div",T,[r("div",Z,k((null==(d=a.camera)?void 0:d.name)||"未配置"),1),r("div",aa,[o(t,{color:a.camera?"success":"default",size:"small"},{default:c(()=>[m(k(a.camera?"已配置":"未配置"),1)]),_:2},1032,["color"])])]),r("div",ea,[a.camera&&a.camera.id?(u(),i("div",la,[r("div",ta,[o(v(w),{class:"camera-icon"}),r("div",sa,k((null==(p=a.camera)?void 0:p.name)||""),1),r("div",na,k((null==(f=a.camera)?void 0:f.location)||""),1)])])):a.camera&&a.camera.id?h("",!0):(u(),i("div",ua,[o(v(b),{class:"add-icon"}),e[17]||(e[17]=r("div",{class:"add-text"},"添加摄像头",-1)),o(l,{size:"small",type:"primary",onClick:a=>{return e=s,wa.value=e,ha.value=!0,void(Ca.value=[]);var e}},{default:c(()=>[...e[16]||(e[16]=[m(" 选择 ",-1)])]),_:2},1032,["onClick"])]))])],2)}),128))])]),U.value&&"running"===U.value.status?(u(),i("div",ia,[r("div",ra,[r("span",oa,"轮巡进度: "+k(ma.value+1)+"/"+k(U.value.cameras.length),1),r("span",ca,"下次切换: "+k(ka.value)+"秒",1)]),o(ga,{percent:Ia.value,"show-info":!1,"stroke-color":{"0%":"#1890ff","100%":"#52c41a"}},null,8,["percent"])])):h("",!0)]}),_:1})])]),o(Qa,{open:pa.value,"onUpdate:open":e[5]||(e[5]=a=>pa.value=a),title:fa.value?"编辑轮巡预案":"新建轮巡预案",width:"700px",onOk:Sa,onCancel:Va},{default:c(()=>[o(Na,{model:xa,layout:"vertical"},{default:c(()=>[o(Oa,{gutter:16},{default:c(()=>[o(Fa,{span:12},{default:c(()=>[o(Ea,{label:"预案名称",required:""},{default:c(()=>[o($a,{value:xa.name,"onUpdate:value":e[0]||(e[0]=a=>xa.name=a),placeholder:"请输入预案名称"},null,8,["value"])]),_:1})]),_:1}),o(Fa,{span:12},{default:c(()=>[o(Ea,{label:"轮巡间隔(秒)",required:""},{default:c(()=>[o(Ga,{value:xa.interval,"onUpdate:value":e[1]||(e[1]=a=>xa.interval=a),min:5,max:300,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(Ea,{label:"选择摄像头",required:""},{default:c(()=>[o(Pa,{"target-keys":xa.selectedCameras,"onUpdate:targetKeys":e[2]||(e[2]=a=>xa.selectedCameras=a),"data-source":za.value,titles:["可选摄像头","已选摄像头"],render:a=>a.title,"show-search":!0,"show-select-all":!1},null,8,["target-keys","data-source","render"])]),_:1}),o(Ea,{label:"轮巡策略"},{default:c(()=>[o(Xa,{value:xa.strategy,"onUpdate:value":e[3]||(e[3]=a=>xa.strategy=a)},{default:c(()=>[o(Wa,{value:"sequential"},{default:c(()=>[...e[18]||(e[18]=[m("顺序轮巡",-1)])]),_:1}),o(Wa,{value:"random"},{default:c(()=>[...e[19]||(e[19]=[m("随机轮巡",-1)])]),_:1}),o(Wa,{value:"priority"},{default:c(()=>[...e[20]||(e[20]=[m("优先级轮巡",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),o(Ea,{label:"生效时间"},{default:c(()=>[o(Ja,{value:xa.timeRange,"onUpdate:value":e[4]||(e[4]=a=>xa.timeRange=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),o(Qa,{open:ha.value,"onUpdate:open":e[7]||(e[7]=a=>ha.value=a),title:"选择摄像头",width:"900px",footer:null},{default:c(()=>[r("div",da,[o(Ta,{value:_a.value,"onUpdate:value":e[6]||(e[6]=a=>_a.value=a),placeholder:"搜索摄像头名称或位置",style:{"margin-bottom":"16px"},"allow-clear":""},null,8,["value"]),o(Za,{columns:qa,"data-source":Ua.value,"row-key":"id",size:"middle",pagination:{pageSize:10,showSizeChanger:!0},"row-selection":{selectedRowKeys:Ca.value,onChange:Ha}},{bodyCell:c(({column:a,record:s})=>["status"===a.key?(u(),_(t,{key:0,color:"success"},{default:c(()=>[...e[21]||(e[21]=[m("在线",-1)])]),_:1})):"action"===a.key?(u(),_(l,{key:1,type:"link",onClick:a=>{return e=s,void(wa.value>=0&&(ya.value[wa.value].camera={id:e.key,name:e.title,location:e.location,status:e.status},ha.value=!1,x.success(`已选择摄像头: ${e.title}`)));var e}},{default:c(()=>[...e[22]||(e[22]=[m("选择",-1)])]),_:2},1032,["onClick"])):h("",!0)]),_:1},8,["data-source","row-selection"])])]),_:1},8,["open"])])}}}),[["__scopeId","data-v-f628083e"]]);export{va as default};
