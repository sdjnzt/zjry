import{d as a,f as e,r as l,c as t,o as s,b as i,V as n,W as u,a0 as r,k as d,$ as c,X as m,u as o,G as v,F as p,a1 as g,a8 as y,a3 as h,B as f,a7 as k,_}from"./vendor-f41c3cc7.js";import{o as C,V as P}from"./icons-15893848.js";import{m as z,P as T,c as w,R as x}from"./antd-fa5730cf.js";import{_ as j}from"./index-5905e6b1.js";const b={class:"intelligent-patrol"},I={class:"page-header"},U={class:"header-content"},$={class:"header-actions"},q={class:"main-content"},D={class:"left-panel"},R={class:"patrol-list"},S=["onClick"],B={class:"patrol-info"},Y={class:"patrol-name"},A={class:"patrol-meta"},H={class:"interval"},L={class:"camera-count"},M={class:"patrol-status"},E={class:"patrol-actions"},K={class:"right-panel"},V={class:"control-bar"},F={class:"current-info"},G={class:"status-text"},O={class:"control-buttons"},W={class:"camera-matrix"},X={class:"matrix-header"},J={class:"matrix-title"},N={class:"matrix-grid"},Q={class:"cell-header"},Z={class:"camera-name"},aa={class:"camera-status"},ea={class:"cell-content"},la={key:0,class:"video-display"},ta={key:0,class:"camera-image"},sa=["src","alt"],ia={class:"time-overlay"},na={class:"timestamp"},ua={key:1,class:"camera-video"},ra=["src"],da={class:"time-overlay"},ca={class:"timestamp"},ma={key:2,class:"video-placeholder"},oa={class:"camera-name"},va={class:"camera-location"},pa={key:1,class:"empty-slot"},ga={key:0,class:"patrol-progress"},ya={class:"progress-header"},ha={class:"progress-text"},fa={class:"next-switch"},ka={class:"camera-picker"},_a=j(a({__name:"intelligent-patrol",setup(a){const j=e(null),_a=e(null),Ca=e(0),Pa=e(!1),za=e(null),Ta=e(null),wa=e(0),xa=e([{camera:null,index:0},{camera:null,index:1},{camera:null,index:2},{camera:null,index:3}]),ja=e(!1),ba=e(""),Ia=e([]),Ua=e(-1),$a=l({name:"",interval:30,selectedCameras:[],strategy:"sequential",timeRange:[]}),qa=e([{id:1,name:"码头重点区域轮巡",status:"running",interval:30,cameras:[{id:1,name:"码头1号监控",location:"码头前沿A区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{id:2,name:"码头2号监控",location:"码头前沿B区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/2.png"},{id:3,name:"码头3号监控",location:"码头前沿C区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/3.png"}]},{id:2,name:"航道监控轮巡",status:"stopped",interval:45,cameras:[{id:4,name:"主航道1号",location:"主航道入口",status:"在线",mediaType:"image",mediaPath:"/zjry/image/4.png"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"}]},{id:3,name:"锚地区域轮巡",status:"stopped",interval:60,cameras:[{id:6,name:"锚地监控点",location:"锚地区域中心",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"}]},{id:4,name:"港区周界巡检",status:"stopped",interval:50,cameras:[{id:7,name:"码头4号监控",location:"码头前沿D区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{id:1,name:"码头1号监控",location:"码头前沿A区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"}]},{id:5,name:"桥区桥面/引桥监控",status:"stopped",interval:40,cameras:[{id:8,name:"航道3号监控",location:"主航道出口",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{id:5,name:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"}]}]),Da=e([{key:1,title:"码头1号监控",location:"码头前沿A区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{key:2,title:"码头2号监控",location:"码头前沿B区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/2.png"},{key:3,title:"码头3号监控",location:"码头前沿C区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/3.png"},{key:4,title:"主航道1号",location:"主航道入口",status:"在线",mediaType:"image",mediaPath:"/zjry/image/4.png"},{key:5,title:"主航道2号",location:"主航道中段",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{key:6,title:"锚地监控点",location:"锚地区域中心",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{key:7,title:"码头4号监控",location:"码头前沿D区",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"},{key:8,title:"航道3号监控",location:"主航道出口",status:"在线",mediaType:"image",mediaPath:"/zjry/image/1.png"}]),Ra=t(()=>j.value?(Ca.value+1)/j.value.cameras.length*100:0),Sa=t(()=>{const a=ba.value.trim().toLowerCase();return a?Da.value.filter(e=>e.title.toLowerCase().includes(a)||e.location.toLowerCase().includes(a)):Da.value}),Ba=[{title:"摄像头名称",dataIndex:"title",key:"title",width:200},{title:"位置",dataIndex:"location",key:"location",width:180},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:100}],Ya=a=>{j.value=a,a.cameras.length>0&&(Ca.value=0,_a.value=a.cameras[0])},Aa=a=>{var e;a.status="running",a.id===(null==(e=j.value)?void 0:e.id)&&(La(),z.success(`预案"${a.name}"已启动`))},Ha=a=>{var e;a.status="stopped",a.id===(null==(e=j.value)?void 0:e.id)&&(Ma(),z.info(`预案"${a.name}"已停止`))},La=()=>{Ta.value&&clearInterval(Ta.value),wa.value=j.value.interval,Ta.value=setInterval(()=>{wa.value--,wa.value<=0&&(Ea(),wa.value=j.value.interval)},1e3)},Ma=()=>{Ta.value&&(clearInterval(Ta.value),Ta.value=null)},Ea=()=>{j.value&&(Ca.value=(Ca.value+1)%j.value.cameras.length,_a.value=j.value.cameras[Ca.value])},Ka=()=>{j.value&&(Ca.value=0===Ca.value?j.value.cameras.length-1:Ca.value-1,_a.value=j.value.cameras[Ca.value])},Va=()=>{j.value&&(Ma(),z.info("轮巡已暂停"))},Fa=a=>{Ia.value=a},Ga=()=>{xa.value.forEach(a=>{a.camera=null}),z.info("矩阵已重置")},Oa=()=>{za.value=null,Ja(),Pa.value=!0},Wa=()=>{if(za.value)za.value.name=$a.name,za.value.interval=$a.interval,za.value.cameras=$a.selectedCameras.map(a=>{const e=Da.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath}:null}).filter(Boolean),z.success("预案已更新");else{const a={id:Date.now(),name:$a.name,status:"stopped",interval:$a.interval,cameras:$a.selectedCameras.map(a=>{const e=Da.value.find(e=>e.key===a);return e?{id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath}:null}).filter(Boolean)};qa.value.push(a),z.success("预案已创建")}Pa.value=!1,Ja()},Xa=()=>{Pa.value=!1,Ja()},Ja=()=>{$a.name="",$a.interval=30,$a.selectedCameras=[],$a.strategy="sequential",$a.timeRange=[]},Na=()=>{const a=new Date;return`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return s(()=>{console.log("智能轮巡组件已挂载"),(()=>{const a=qa.value[0];a&&a.cameras.length>0&&a.cameras.forEach((a,e)=>{e<3&&(xa.value[e].camera={id:a.id,name:a.name,location:a.location,status:a.status,mediaType:a.mediaType,mediaPath:a.mediaPath})})})(),qa.value.length>0&&Ya(qa.value[0])}),i(()=>{Ta.value&&clearInterval(Ta.value)}),(a,e)=>{const l=m("a-button"),t=m("a-tag"),s=m("a-card"),i=m("a-button-group"),Ta=m("a-progress"),La=m("a-input"),Ja=m("a-form-item"),Qa=m("a-col"),Za=m("a-input-number"),ae=m("a-row"),ee=m("a-transfer"),le=m("a-radio"),te=m("a-radio-group"),se=m("a-range-picker"),ie=m("a-form"),ne=m("a-modal"),ue=m("a-input-search"),re=m("a-table");return n(),u("div",b,[r("div",I,[r("div",U,[e[9]||(e[9]=r("div",{class:"title-section"},[r("h1",null,"智能轮巡"),r("p",null,"预设视频轮巡预案，系统自动按设定时间间隔切换大屏显示画面")],-1)),r("div",$,[d(l,{type:"primary",size:"large",onClick:Oa},{default:c(()=>[d(o(T)),e[8]||(e[8]=v(" 新建预案 ",-1))]),_:1})])])]),r("div",q,[r("div",D,[d(s,{title:"轮巡预案管理",class:"patrol-card"},{default:c(()=>[r("div",R,[(n(!0),u(p,null,g(qa.value,a=>{var s;return n(),u("div",{key:a.id,class:y(["patrol-item",{active:(null==(s=j.value)?void 0:s.id)===a.id}]),onClick:e=>Ya(a)},[r("div",B,[r("div",Y,h(a.name),1),r("div",A,[r("span",H,"间隔: "+h(a.interval)+"秒",1),r("span",L,h(a.cameras.length)+"个摄像头",1)])]),r("div",M,[d(t,{color:"running"===a.status?"success":"default"},{default:c(()=>[v(h("running"===a.status?"运行中":"已停止"),1)]),_:2},1032,["color"])]),r("div",E,[d(l,{size:"small",type:"running"===a.status?"default":"primary",onClick:f(e=>(a=>{"running"===a.status?Ha(a):Aa(a)})(a),["stop"])},{default:c(()=>[v(h("running"===a.status?"停止":"启动"),1)]),_:2},1032,["type","onClick"]),d(l,{size:"small",onClick:f(e=>(a=>{za.value=a,$a.name=a.name,$a.interval=a.interval,$a.selectedCameras=a.cameras.map(a=>a.id),$a.strategy="sequential",Pa.value=!0})(a),["stop"])},{default:c(()=>[...e[10]||(e[10]=[v(" 编辑 ",-1)])]),_:2},1032,["onClick"]),d(l,{size:"small",danger:"",onClick:f(e=>(a=>{var e;const l=qa.value.findIndex(e=>e.id===a.id);l>-1&&(qa.value.splice(l,1),(null==(e=j.value)?void 0:e.id)===a.id&&(j.value=null,_a.value=null,Ma()),z.success("预案已删除"))})(a),["stop"])},{default:c(()=>[...e[11]||(e[11]=[v(" 删除 ",-1)])]),_:2},1032,["onClick"])])],10,S)}),128))])]),_:1})]),r("div",K,[d(s,{title:"轮巡预览",class:"preview-card"},{default:c(()=>{var a;return[r("div",V,[r("div",F,[r("h3",null,h(j.value?j.value.name:"未选择预案"),1),r("span",G,h("running"===(null==(a=j.value)?void 0:a.status)?"运行中":"已停止"),1)]),r("div",O,[d(i,null,{default:c(()=>[d(l,{disabled:!j.value||"running"!==j.value.status,onClick:Ka},{default:c(()=>[d(o(w)),e[12]||(e[12]=v(" 上一个 ",-1))]),_:1},8,["disabled"]),d(l,{disabled:!j.value||"running"!==j.value.status,onClick:Va},{default:c(()=>[d(o(C)),e[13]||(e[13]=v(" 暂停 ",-1))]),_:1},8,["disabled"]),d(l,{disabled:!j.value||"running"!==j.value.status,onClick:Ea},{default:c(()=>[e[14]||(e[14]=v(" 下一个 ",-1)),d(o(x))]),_:1},8,["disabled"])]),_:1})])]),r("div",W,[r("div",X,[r("span",J,"摄像头矩阵 ("+h(xa.value.length)+"个位置)",1),d(l,{size:"small",onClick:Ga},{default:c(()=>[...e[15]||(e[15]=[v("重置矩阵",-1)])]),_:1})]),r("div",N,[(n(!0),u(p,null,g(xa.value,(a,s)=>{var i,m,p,g;return n(),u("div",{key:`cell-${s}`,class:y(["matrix-cell",{"has-camera":!!a.camera,"current-active":"running"===(null==(i=j.value)?void 0:i.status)&&Ca.value===s}])},[r("div",Q,[r("div",Z,h((null==(m=a.camera)?void 0:m.name)||"未配置"),1),r("div",aa,[d(t,{color:a.camera?"success":"default",size:"small"},{default:c(()=>[v(h(a.camera?"已配置":"未配置"),1)]),_:2},1032,["color"])])]),r("div",ea,[a.camera&&a.camera.id?(n(),u("div",la,["image"===a.camera.mediaType&&a.camera.mediaPath?(n(),u("div",ta,[r("img",{src:a.camera.mediaPath,alt:`${a.camera.name}摄像头`,class:"camera-img"},null,8,sa),r("div",ia,[r("div",na,h(Na()),1)])])):"video"===a.camera.mediaType&&a.camera.mediaPath?(n(),u("div",ua,[r("video",{src:a.camera.mediaPath,autoplay:"",muted:"",loop:"",class:"camera-vid"},null,8,ra),r("div",da,[r("div",ca,h(Na()),1)])])):(n(),u("div",ma,[d(o(P),{class:"camera-icon"}),r("div",oa,h((null==(p=a.camera)?void 0:p.name)||""),1),r("div",va,h((null==(g=a.camera)?void 0:g.location)||""),1)]))])):a.camera&&a.camera.id?k("",!0):(n(),u("div",pa,[d(o(T),{class:"add-icon"}),e[17]||(e[17]=r("div",{class:"add-text"},"添加摄像头",-1)),d(l,{size:"small",type:"primary",onClick:a=>{return e=s,Ua.value=e,ja.value=!0,void(Ia.value=[]);var e}},{default:c(()=>[...e[16]||(e[16]=[v(" 选择 ",-1)])]),_:2},1032,["onClick"])]))])],2)}),128))])]),j.value&&"running"===j.value.status?(n(),u("div",ga,[r("div",ya,[r("span",ha,"轮巡进度: "+h(Ca.value+1)+"/"+h(j.value.cameras.length),1),r("span",fa,"下次切换: "+h(wa.value)+"秒",1)]),d(Ta,{percent:Ra.value,"show-info":!1,"stroke-color":{"0%":"#1890ff","100%":"#52c41a"}},null,8,["percent"])])):k("",!0)]}),_:1})])]),d(ne,{open:Pa.value,"onUpdate:open":e[5]||(e[5]=a=>Pa.value=a),title:za.value?"编辑轮巡预案":"新建轮巡预案",width:"700px",onOk:Wa,onCancel:Xa},{default:c(()=>[d(ie,{model:$a,layout:"vertical"},{default:c(()=>[d(ae,{gutter:16},{default:c(()=>[d(Qa,{span:12},{default:c(()=>[d(Ja,{label:"预案名称",required:""},{default:c(()=>[d(La,{value:$a.name,"onUpdate:value":e[0]||(e[0]=a=>$a.name=a),placeholder:"请输入预案名称"},null,8,["value"])]),_:1})]),_:1}),d(Qa,{span:12},{default:c(()=>[d(Ja,{label:"轮巡间隔(秒)",required:""},{default:c(()=>[d(Za,{value:$a.interval,"onUpdate:value":e[1]||(e[1]=a=>$a.interval=a),min:5,max:300,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),d(Ja,{label:"选择摄像头",required:""},{default:c(()=>[d(ee,{"target-keys":$a.selectedCameras,"onUpdate:targetKeys":e[2]||(e[2]=a=>$a.selectedCameras=a),"data-source":Da.value,titles:["可选摄像头","已选摄像头"],render:a=>a.title,"show-search":!0,"show-select-all":!1},null,8,["target-keys","data-source","render"])]),_:1}),d(Ja,{label:"轮巡策略"},{default:c(()=>[d(te,{value:$a.strategy,"onUpdate:value":e[3]||(e[3]=a=>$a.strategy=a)},{default:c(()=>[d(le,{value:"sequential"},{default:c(()=>[...e[18]||(e[18]=[v("顺序轮巡",-1)])]),_:1}),d(le,{value:"random"},{default:c(()=>[...e[19]||(e[19]=[v("随机轮巡",-1)])]),_:1}),d(le,{value:"priority"},{default:c(()=>[...e[20]||(e[20]=[v("优先级轮巡",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),d(Ja,{label:"生效时间"},{default:c(()=>[d(se,{value:$a.timeRange,"onUpdate:value":e[4]||(e[4]=a=>$a.timeRange=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),d(ne,{open:ja.value,"onUpdate:open":e[7]||(e[7]=a=>ja.value=a),title:"选择摄像头",width:"900px",footer:null},{default:c(()=>[r("div",ka,[d(ue,{value:ba.value,"onUpdate:value":e[6]||(e[6]=a=>ba.value=a),placeholder:"搜索摄像头名称或位置",style:{"margin-bottom":"16px"},"allow-clear":""},null,8,["value"]),d(re,{columns:Ba,"data-source":Sa.value,"row-key":"id",size:"middle",pagination:{pageSize:10,showSizeChanger:!0},"row-selection":{selectedRowKeys:Ia.value,onChange:Fa}},{bodyCell:c(({column:a,record:s})=>["status"===a.key?(n(),_(t,{key:0,color:"success"},{default:c(()=>[...e[21]||(e[21]=[v("在线",-1)])]),_:1})):"action"===a.key?(n(),_(l,{key:1,type:"link",onClick:a=>{return e=s,void(Ua.value>=0&&(xa.value[Ua.value].camera={id:e.key,name:e.title,location:e.location,status:e.status,mediaType:e.mediaType,mediaPath:e.mediaPath},ja.value=!1,z.success(`已选择摄像头: ${e.title}`)));var e}},{default:c(()=>[...e[22]||(e[22]=[v("选择",-1)])]),_:2},1032,["onClick"])):k("",!0)]),_:1},8,["data-source","row-selection"])])]),_:1},8,["open"])])}}}),[["__scopeId","data-v-4633c4d2"]]);export{_a as default};
